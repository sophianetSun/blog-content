Date: 2024-04-12
Tag: moment
    dayjs
Status: pub

업무에서 날짜 관련해 [dayjs](https://day.js.org/)와 [moment](https://momentjs.com/) 시간 관련한 javascript 라이브러리를 사용하고 있다. dayjs 라이브러리는 moment 라이브러리의 구현을 최적화 해놓은 것으로 같은 기능의 용량이 매우 적다.

여러 프로젝트를 겪으면서 얻은 경험으로 시간 처리는 숫자로 하는게 가장 마음 편하다는 것이었는데, 처음부터 개발하는 상황도 아니고, 이미 사용하고 있었기에 당연히 적응해야 했다. _시간 처리를 숫자로 하는 것에 할말이 매우 많은데 이는 다음 기회에 다뤄 보기로..._

서비스는 미국 LA에서, 개발은 한국에서 하고 있기 때문에 시간 관련해 이슈가 매우 많이 나오는 상황이다. 타임 존 사용에 대한 일관성은 역시 가장 큰 문제랄까.. 

물론 오늘 하고 싶은 이야기는 `isBetween`이다. 

처음에는 당연히 Between이면 sql문의 WHERE ... BETWEEN A AND B 를 생각했지만, 이게 오산이었다. _이래서 개발자는 문서를 바이블 처럼 생각해야_

SQL의 BETWEEN은 inclusive, 즉 ~ 보다는 크거나 같고(>=), ~ 보다 작거나 같다(<=) 지만 이 2라이브러리의 경우에 between은 말 그대로 A와 B의 사이가 기본 값이었다.

[https://day.js.org/docs/en/query/is-between](https://day.js.org/docs/en/query/is-between) 문서를 참고해보면 

> dayjs('2010-10-20').isBetween('2010-10-19', dayjs('2010-10-25'))

2010년 10월 20일이 2010년 10월 19일과 2010년 10월 25일 사이냐 라는 것인데, 또 이렇게 적어 놓으니 이 함수의 정의된 기본값이 맞아 보이긴 하다. 하지만 코드에서 시간 관련해 구현할 때는 시, 분, 초 단위까지 사용하기 때문에 대부분

> dayjs('2010-10-20 14:17:32').isBetween('2010-10-19 00:00:00', dayjs('2010-10-25 23:00:00'))

식으로 사용을 하게 된다. 이 경우 왠만하면 문제가 되지 않겠지만, 시간에 사람의 의도적인 개입이 들어가는 경우. 예를 들어 스타벅스 음료 마일리지 12개가 쌓여 다음 날 무료 쿠폰을 발급해야 할 때, 보자 오늘이 4월 12일 이니, 쿠폰의 발급 시간과 사용 기간은 2024년 4월 13일 0시 0분 0초 부터가 되겠다. 이렇게 추상적인 시간이 의도적으로 구체적인 시간으로 바뀌어야 할 때 이런 문제가 발생하게 된다. 그럴 때 위와 같은 isBetween에서 실수가 발생하게 되는 것이다.

물론, 이를 해결하는 방법도 아주 쉽다. 잘 만들어진 라이브러리는 역시 이런 맛이지!

isBetween 함수는 (가장 빠른 시간, 가장 늦은 시간, 년/월/일/시/분/초 시간 단위, 포함하는지 포함하지 않는지 결정하는 결정자 이다). 수학에서의 표현과 마찬가지로, `[]`은 포함한다이고, `()`은 포함하지 않는다 이다. `[)` 은 빠른 시간은 포함하고, 늦은 시간은 포함하지 않으며, `(]`은 빠른 시간은 포함하지 않고 늦은 시간은 포함하다 이다.

간단하지 않은가?

